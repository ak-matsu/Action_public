name: 30min_ts

on:
  schedule:
    - cron: '*/30 * * * *'  # 30分ごとに実行
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send main message to Slack
        id: send_slack_message
        run: |
          curl -X POST -H 'Content-type: application/json' \
               --data '{"text":"📢 定期通知: GitHub Pages の更新情報"}' \
               ${{ secrets.SLACK_WEBHOOK_URL }}

      - name: Extract timestamp
        run: |
          echo "SLACK_TS=$(jq -r '.ts' <<< '${{ steps.send_slack_message.outputs.response }}')" >> $GITHUB_ENV

      - name: Reply in Thread
        run: |
          curl -X POST -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
               -H "Content-type: application/json" \
               --data '{
                 "channel": "CLR0Z1NF9",
                 "text": "🔄 追加情報: 最新の更新内容はこちら。",
                 "thread_ts": "'$SLACK_TS'"
               }' \
               https://slack.com/api/chat.postMessage
