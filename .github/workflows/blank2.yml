name: 30min_ts

on:
  schedule:
    - cron: '*/30 * * * *'  # 30分ごとに実行
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Send main message to Slack
        id: send_slack_message
        run: |
          RESPONSE=$(curl -X POST -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
                          -H "Content-type: application/json" \
                          --data '{
                            "channel": "CLR0Z1NF9",
                            "text": "📢 定期通知: GitHub Pages の更新情報"
                          }' \
                          https://slack.com/api/chat.postMessage)
          
          SLACK_TS=$(echo "$RESPONSE" | jq -r '.ts')
          
          echo "SLACK_TS=$SLACK_TS" >> $GITHUB_ENV

      - name: Reply in Thread
        run: |
          curl -X POST -H "Authorization: Bearer ${{ secrets.SLACK_BOT_TOKEN }}" \
               -H "Content-type: application/json" \
               --data '{
                 "channel": "CLR0Z1NF9",
                 "text": "🔄 追加情報: 最新の更新内容はこちら。",
                 "thread_ts": "'"$SLACK_TS"'"
               }' \
               https://slack.com/api/chat.postMessage
